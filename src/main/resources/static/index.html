<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z-RAG 智能问答系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="lib/font-awesome/css/all.min.css" rel="stylesheet">
    
    <!-- 文档预览库 -->
    <script src="lib/mammoth/mammoth.browser.min.js"></script>
    <script src="lib/xlsx/xlsx.full.min.js"></script>
    <script src="lib/pdfjs/pdf.min.js"></script>
</head>
<body>
<div class="app-container">
    <!-- 移动端菜单按钮 -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- 侧边栏 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="bagua-icon">☯</i> Z-RAG</h2>
            <p>智能问答系统</p>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item active" data-tab="chat">
                    <i class="fas fa-comments"></i>
                    <span>智能问答</span>
                </li>
                <li class="nav-item" data-tab="documents">
                    <i class="fas fa-file-alt"></i>
                    <span>文档管理</span>
                </li>
                <li class="nav-item" data-tab="knowledge">
                    <i class="fas fa-database"></i>
                    <span>知识管理</span>
                </li>
                <li class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>系统设置</span>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="system-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">系统正常</span>
            </div>
            <div class="theme-switch">
                <button class="btn btn-sm btn-secondary" onclick="switchToStock()">
                    <i class="fas fa-chart-line"></i> 切换到股神投资
                </button>
            </div>
        </div>
    </aside>
    
    <!-- 移动端遮罩层 -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 智能问答页面 -->
        <div class="tab-content active" id="chat">
            <div class="chat-container">
                <div class="chat-header">
                    <h3><i class="fas fa-robot"></i> 智能问答助手</h3>
                    <div class="chat-controls">
                        <button class="btn btn-secondary" id="clearChat">
                            <i class="fas fa-trash"></i> 清空对话
                        </button>
                        <button class="btn btn-primary" id="newChat">
                            <i class="fas fa-plus"></i> 新建对话
                        </button>
                    </div>
                </div>
                
                <div class="chat-content">
                    <div class="chat-messages" id="chatMessages">
                        <div class="welcome-message">
                            <div class="welcome-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h4>欢迎使用 Z-RAG 智能问答系统</h4>
                            <p>我可以帮您回答基于文档的问题，请上传文档后开始提问。</p>
                        </div>
                    </div>
                    
                    <!-- 右侧引用信息区域 -->
                    <div class="references-panel" id="referencesPanel">
                        <div class="references-header">
                            <h4><i class="fas fa-book"></i> 引用来源</h4>
                            <button class="btn btn-sm btn-secondary" id="toggleReferences">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="references-content" id="referencesContent">
                            <div class="no-references">
                                <i class="fas fa-info-circle"></i>
                                <p>暂无引用信息</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea id="chatInput" placeholder="请输入您的问题..." rows="3"></textarea>
                        <button class="btn btn-primary" id="sendMessage">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="input-hints">
                        <span class="hint">按 Enter 发送，Shift+Enter 换行</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 文档管理页面 -->
        <div class="tab-content" id="documents">
            <div class="page-header">
                <h3><i class="fas fa-file-alt"></i> 文档管理</h3>
                <div class="page-actions">
                    <button class="btn btn-primary" id="uploadDocument">
                        <i class="fas fa-upload"></i> 上传文档
                    </button>
                    <button class="btn btn-secondary" id="refreshDocuments">
                        <i class="fas fa-sync"></i> 刷新
                    </button>
                </div>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>拖拽文件到此处或点击上传</h4>
                    <p>支持 PDF, TXT, DOC, DOCX, MD, XLS, XLSX, PPT, PPTX, 图片等格式</p>
                    <input type="file" id="fileInput" multiple accept=".pdf,.txt,.doc,.docx,.md,.xls,.xlsx,.ppt,.pptx,.png,.jpg,.jpeg,.gif,.bmp">
                </div>
            </div>
            
            <div class="documents-list">
                <div class="list-header">
                    <h4>已上传文档</h4>
                    <div class="list-controls">
                        <input type="text" id="searchDocuments" placeholder="搜索文档...">
                        <select id="sortDocuments">
                            <option value="name">按名称排序</option>
                            <option value="date">按日期排序</option>
                            <option value="size">按大小排序</option>
                        </select>
                    </div>
                </div>
                <div class="documents-grid" id="documentsGrid">
                    <!-- 文档列表将在这里动态生成 -->
                </div>
                <div class="pagination-container" id="paginationContainer">
                    <!-- 分页控件将在这里动态生成 -->
                </div>
            </div>
        </div>
        
        <!-- 知识管理页面 -->
        <div class="tab-content" id="knowledge">
            <div class="page-header">
                <h3><i class="fas fa-database"></i> 知识管理</h3>
                <div class="page-actions">
                    <button class="btn btn-primary" id="createKnowledge">
                        <i class="fas fa-plus"></i> 创建知识库
                    </button>
                    <button class="btn btn-secondary" id="refreshKnowledge">
                        <i class="fas fa-sync"></i> 刷新
                    </button>
                </div>
            </div>
            
            <div class="knowledge-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h4 id="totalDocuments">0</h4>
                        <p>文档总数</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <h4 id="totalChunks">0</h4>
                        <p>知识片段</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <h4 id="knowledgeBaseName">Z-RAG 知识库</h4>
                        <p>知识库名称</p>
                    </div>
                </div>
            </div>
            
            <div class="knowledge-content">
                <div class="knowledge-tabs">
                    <button class="tab-btn active" data-knowledge-tab="chunks">知识片段</button>
                    <button class="tab-btn" data-knowledge-tab="vectors">向量数据</button>
                    <button class="tab-btn" data-knowledge-tab="analytics">分析报告</button>
                </div>
                
                <div class="knowledge-tab-content">
                    <div class="knowledge-tab active" id="chunks">
                        <div class="chunks-list" id="chunksList">
                            <!-- 知识片段列表将在这里动态生成 -->
                        </div>
                    </div>
                    <div class="knowledge-tab" id="vectors">
                        <div class="vectors-info">
                            <h4>向量数据概览</h4>
                            <p>向量维度: 384</p>
                            <p>向量数量: <span id="vectorCount">0</span></p>
                            <p>存储类型: 内存存储</p>
                        </div>
                    </div>
                    <div class="knowledge-tab" id="analytics">
                        <div class="analytics-content">
                            <h4>使用分析</h4>
                            <div class="chart-placeholder">
                                <i class="fas fa-chart-bar"></i>
                                <p>分析图表将在这里显示</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 系统设置页面 -->
        <div class="tab-content" id="settings">
            <div class="page-header">
                <h3><i class="fas fa-cog"></i> 系统设置</h3>
            </div>
            
            <div class="settings-content">
                <div class="settings-section">
                    <h4>模型配置</h4>
                    <div class="form-group">
                        <label for="modelProvider">模型提供商</label>
                        <select id="modelProvider">
                            <option value="qwen">千问 (推荐)</option>
                            <option value="openai">OpenAI</option>
                            <option value="ollama">Ollama</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="password" id="apiKey" placeholder="请输入API Key">
                    </div>
                    <div class="form-group">
                        <label for="modelName">模型名称</label>
                        <input type="text" id="modelName" placeholder="模型名称">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>检索配置</h4>
                    <div class="form-group">
                        <label for="maxResults">最大结果数</label>
                        <input type="number" id="maxResults" value="5" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label for="minScore">最小相似度</label>
                        <input type="number" id="minScore" value="0.6" min="0" max="1" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="chunkSize">文档块大小</label>
                        <input type="number" id="chunkSize" value="300" min="100" max="1000">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>系统信息</h4>
                    <div class="system-info">
                        <div class="info-item">
                            <span class="info-label">Java版本:</span>
                            <span class="info-value" id="javaVersion">8</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Spring Boot版本:</span>
                            <span class="info-value" id="springBootVersion">2.7.18</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">LangChain4j版本:</span>
                            <span class="info-value" id="langchain4jVersion">0.29.1</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">系统状态:</span>
                            <span class="info-value" id="systemStatus">正常</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn btn-primary" id="saveSettings">保存设置</button>
                    <button class="btn btn-secondary" id="resetSettings">重置设置</button>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- 模态框 -->
<div class="modal" id="uploadModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>上传文档</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="upload-form">
                <input type="file" id="modalFileInput" multiple accept=".pdf,.txt,.doc,.docx,.md,.xls,.xlsx,.ppt,.pptx,.png,.jpg,.jpeg,.gif,.bmp">
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-text" id="progressText">0%</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelUpload">取消</button>
            <button class="btn btn-primary" id="confirmUpload">上传</button>
        </div>
    </div>
</div>

<!-- 通知容器 -->
<div class="notifications" id="notifications"></div>

<script src="js/app.js"></script>
</body>
</html>
